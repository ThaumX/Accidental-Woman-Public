Macro.add("accordion",{tags:["accord"],handler(){const e=this.args[0];let t=`<div id="${e}">`;for(let e=0,s=this.payload.length;e<s;e++)"accord"===this.payload[e].name?t+=`<h3>${this.payload[e].args[0]}</h3><div>${this.payload[e].contents}</div>`:t+=`<h3>${this.payload[e].args[1]}</h3><div>${this.payload[e].contents}</div>`;t+="</div>";let s="emptyclass";3===this.payload[0].args.length&&(s=this.payload[0].args[2]);const n="#"+e;return $(function(){$(n).accordion({heightStyle:"fill",classes:{"ui-accordion-content":s}})}),new Wikifier(this.output,t)}}),aw.code=function(){let e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function i(e,t){if(!n[e]){n[e]={};for(let t=0;t<e.length;t++)n[e][e.charAt(t)]=t}return n[e][t]}return aw.code={compressToBase64(e){if(null==e)return"";const s=aw.code._compress(e,6,function(e){return t.charAt(e)});switch(s.length%4){default:case 0:return s;case 1:return s+"===";case 2:return s+"==";case 3:return s+"="}},decompressFromBase64:e=>null==e?"":""==e?null:aw.code._decompress(e.length,32,function(s){return i(t,e.charAt(s))}),compressToUTF16:t=>null==t?"":aw.code._compress(t,15,function(t){return e(t+32)})+" ",decompressFromUTF16:e=>null==e?"":""==e?null:aw.code._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32}),compressToUint8Array(e){let t=aw.code.compress(e),s=new Uint8Array(2*t.length);for(let e=0,n=t.length;e<n;e++){const n=t.charCodeAt(e);s[2*e]=n>>>8,s[2*e+1]=n%256}return s},decompressFromUint8Array(t){if(null==t)return aw.code.decompress(t);{const s=new Array(t.length/2);for(let e=0,n=s.length;e<n;e++)s[e]=256*t[2*e]+t[2*e+1];const n=[];return s.forEach(function(t){n.push(e(t))}),aw.code.decompress(n.join(""))}},compressToEncodedURIComponent:e=>null==e?"":aw.code._compress(e,6,function(e){return s.charAt(e)}),decompressFromEncodedURIComponent:e=>null==e?"":""==e?null:(e=e.replace(/ /g,"+"),aw.code._decompress(e.length,32,function(t){return i(s,e.charAt(t))})),compress:t=>aw.code._compress(t,16,function(t){return e(t)}),_compress(e,t,s){if(null==e)return"";let n,i,r,a={},o={},l="",u="",c="",d=2,h=3,m=2,p=[],g=0,f=0;for(r=0;r<e.length;r+=1)if(l=e.charAt(r),Object.prototype.hasOwnProperty.call(a,l)||(a[l]=h++,o[l]=!0),u=c+l,Object.prototype.hasOwnProperty.call(a,u))c=u;else{if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(n=0;n<m;n++)g<<=1,f==t-1?(f=0,p.push(s(g)),g=0):f++;for(i=c.charCodeAt(0),n=0;n<8;n++)g=g<<1|1&i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i>>=1}else{for(i=1,n=0;n<m;n++)g=g<<1|i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i=0;for(i=c.charCodeAt(0),n=0;n<16;n++)g=g<<1|1&i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i>>=1}0==--d&&(d=Math.pow(2,m),m++),delete o[c]}else for(i=a[c],n=0;n<m;n++)g=g<<1|1&i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i>>=1;0==--d&&(d=Math.pow(2,m),m++),a[u]=h++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(o,c)){if(c.charCodeAt(0)<256){for(n=0;n<m;n++)g<<=1,f==t-1?(f=0,p.push(s(g)),g=0):f++;for(i=c.charCodeAt(0),n=0;n<8;n++)g=g<<1|1&i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i>>=1}else{for(i=1,n=0;n<m;n++)g=g<<1|i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i=0;for(i=c.charCodeAt(0),n=0;n<16;n++)g=g<<1|1&i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i>>=1}0==--d&&(d=Math.pow(2,m),m++),delete o[c]}else for(i=a[c],n=0;n<m;n++)g=g<<1|1&i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i>>=1;0==--d&&(d=Math.pow(2,m),m++)}for(i=2,n=0;n<m;n++)g=g<<1|1&i,f==t-1?(f=0,p.push(s(g)),g=0):f++,i>>=1;for(;;){if(g<<=1,f==t-1){p.push(s(g));break}f++}return p.join("")},decompress:e=>null==e?"":""==e?null:aw.code._decompress(e.length,32768,function(t){return e.charCodeAt(t)}),_decompress(t,s,n){let i,r,a,o,l,u,c,d,h=[],m=4,p=4,g=3,f="",v=[],b={val:n(0),position:s,index:1};for(r=0;r<3;r+=1)h[r]=r;for(o=0,u=Math.pow(2,2),c=1;c!=u;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=s,b.val=n(b.index++)),o|=(l>0?1:0)*c,c<<=1;switch(i=o){case 0:for(o=0,u=Math.pow(2,8),c=1;c!=u;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=s,b.val=n(b.index++)),o|=(l>0?1:0)*c,c<<=1;d=e(o);break;case 1:for(o=0,u=Math.pow(2,16),c=1;c!=u;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=s,b.val=n(b.index++)),o|=(l>0?1:0)*c,c<<=1;d=e(o);break;case 2:return""}for(h[3]=d,a=d,v.push(d);;){if(b.index>t)return"";for(o=0,u=Math.pow(2,g),c=1;c!=u;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=s,b.val=n(b.index++)),o|=(l>0?1:0)*c,c<<=1;switch(d=o){case 0:for(o=0,u=Math.pow(2,8),c=1;c!=u;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=s,b.val=n(b.index++)),o|=(l>0?1:0)*c,c<<=1;h[p++]=e(o),d=p-1,m--;break;case 1:for(o=0,u=Math.pow(2,16),c=1;c!=u;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=s,b.val=n(b.index++)),o|=(l>0?1:0)*c,c<<=1;h[p++]=e(o),d=p-1,m--;break;case 2:return v.join("")}if(0==m&&(m=Math.pow(2,g),g++),h[d])f=h[d];else{if(d!==p)return null;f=a+a.charAt(0)}v.push(f),h[p++]=a+f.charAt(0),a=f,0==--m&&(m=Math.pow(2,g),g++)}}},aw.code}(),aw.UTFBase64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,s,n,i,r,a,o,l="",u=0;for(e=Base64._utf8_encode(e);u<e.length;)i=(t=e.charCodeAt(u++))>>2,r=(3&t)<<4|(s=e.charCodeAt(u++))>>4,a=(15&s)<<2|(n=e.charCodeAt(u++))>>6,o=63&n,isNaN(s)?a=o=64:isNaN(n)&&(o=64),l=l+this._keyStr.charAt(i)+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(o);return l},decode:function(e){var t,s,n,i,r,a,o="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(i=this._keyStr.indexOf(e.charAt(l++)))>>4,s=(15&i)<<4|(r=this._keyStr.indexOf(e.charAt(l++)))>>2,n=(3&r)<<6|(a=this._keyStr.indexOf(e.charAt(l++))),o+=String.fromCharCode(t),64!=r&&(o+=String.fromCharCode(s)),64!=a&&(o+=String.fromCharCode(n));return o=Base64._utf8_decode(o)},_utf8_encode:function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var s=0;s<e.length;s++){var n=e.charCodeAt(s);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){var t,s,n,i="",r=0;for(t=s=0;r<e.length;)(t=e.charCodeAt(r))<128?(i+=String.fromCharCode(t),r++):t>191&&t<224?(s=e.charCodeAt(r+1),i+=String.fromCharCode((31&t)<<6|63&s),r+=2):(s=e.charCodeAt(r+1),n=e.charCodeAt(r+2),i+=String.fromCharCode((15&t)<<12|(63&s)<<6|63&n),r+=3);return i}},setup.consumables={},setup.consumables.options={storyVar:"cInv",emptyMsg:"Not carrying any consumables.",tryGlobal:!0,macroAlts:!0,silentCode:!0},State.variables[setup.consumables.options.storyVar]={carried:[],all:[]},setup.consumables.ref=(()=>State.variables[setup.consumables.options.storyVar]),setup.consumables.getConsumable=function(e){const t=setup.consumables.ref();return t.all.includes(e)?clone(t[e]):null},setup.consumables.hasConsumable=function(e,t){const s=setup.consumables.ref();if(!s.all.includes(e))throw new TypeError("no consumable named "+e+" exists.");return arguments.length<2&&(t=1),s[e].amt>=t},setup.consumables.amtOfConsumable=function(e){const t=setup.consumables.ref();return t.carried.includes(e)?t[e].amt:t.all.includes(e)?0:-1},setup.consumables.consumableExists=function(e){return!!setup.consumables.ref().all.includes(e)},setup.consumables.getConsumableName=function(e){const t=setup.consumables.ref();return t.all.includes(e)?t[e].name:null},setup.consumables.getConsumableCode=function(e){const t=setup.consumables.ref();return t.all.includes(e)?t[e].code:null},setup.consumables.getConsumableDescr=function(e){const t=setup.consumables.ref();return t.all.includes(e)?[t[e].descr,t[e].dCode]:null},setup.consumables.getAllConsumables=function(){const e=setup.consumables.ref();return 0===e.all.length?null:clone(e.all)},setup.consumables.getCarriedConsumables=function(){const e=setup.consumables.ref();return 0===e.carried.length?null:clone(e.carried)},setup.consumables.findConsumableByIndex=function(e){const t=setup.consumables.ref();return t.all.length<e-1?null:t.all[e]},setup.consumables.findIndexOfConsumable=function(e){return setup.consumables.ref().all.indexOf(e)},setup.consumables.deleteConsumable=function(e){const t=setup.consumables.ref();let s;t.all.includes(e)&&(s=t.all.indexOf(e),t.all.deleteAt(s)),t.carried.includes(e)&&(s=t.carried.indexOf(e),t.carried.deleteAt(s)),void 0!==t[e]&&delete t[e]},setup.consumables.add=function(e,t=1){const s=setup.consumables.ref();if("number"!=typeof t)return void aw.con.warn(`optional second argument should be a number, given ${t} for key ${e}.`);if(!s.all.includes(e))return void aw.con.warn("no consumable with id "+e+" is defined");s.carried.includes(e)||s.carried.push(e);const n=s[e];n.amt<=0&&(n.amt=0),n.amt+=t},setup.consumables.options.tryGlobal&&(void 0===window.getConsumable&&(window.getConsumable=setup.consumables.getConsumable),void 0===window.hasConsumable&&(window.hasConsumable=setup.consumables.hasConsumable),void 0===window.amtOfConsumable&&(window.amtOfConsumable=setup.consumables.amtOfConsumable),void 0===window.consumableExists&&(window.consumableExists=setup.consumables.consumableExists),void 0===window.getConsumableName&&(window.getConsumableName=setup.consumables.getConsumableName),void 0===window.getConsumableCode&&(window.getConsumableCode=setup.consumables.getConsumableCode),void 0===window.getConsumableDescr&&(window.getConsumableDescr=setup.consumables.getConsumableDescr),void 0===window.getAllConsumables&&(window.getAllConsumables=setup.consumables.getAllConsumables),void 0===window.getCarriedConsumables&&(window.getCarriedConsumables=setup.consumables.getCarriedConsumables),void 0===window.findConsumableByIndex&&(window.findConsumableByIndex=setup.consumables.findConsumableByIndex),void 0===window.findIndexOfConsumable&&(window.findIndexOfConsumable=setup.consumables.findIndexOfConsumable),void 0===window.deleteConsumable&&(window.deleteConsumable=setup.consumables.deleteConsumable)),Macro.add("newconsumable",{tags:["description","canuse"],handler(){const conRef=setup.consumables.ref();if(this.args.length<1)return this.error("you must name your consumable");if(this.args.length>2)return this.error("you may only include a name and optional ID as arguments in a consumable definition");const consumableCode=clone(this.payload[0].contents),consumableName=clone(this.args[0]),consumableID=1===this.args.length?clone(this.args[0]):clone(this.args[1]);let descrCode="",description=null,canUse="";if(this.payload.length>3)return this.error("only one <<description>> tag and <<canuse>> tag is allowed per consumable definition");if(this.payload.length<2)return this.error("Insufficient tags, must at least have <<description>> tag when defining item");if(2===this.payload.length){if(this.payload[1].args>1)return this.error("<<description>> tag has too many arguments");1===this.payload[1].args.length?(descrCode=this.payload[1].args[0],description="passage"):(descrCode=this.payload[1].contents,description="code"),canUse="(function() {return true;})"}else if(3===this.payload.length){if(this.payload[1].args>1)return this.error("<<description>> tag has too many arguments");1===this.payload[1].args.length?(descrCode=this.payload[1].args[0],description="passage"):(descrCode=this.payload[1].contents,description="code"),canUse=`(function() {${this.payload[2].contents}})`}setup.consumables.deleteConsumable(consumableID),conRef[consumableID]={id:consumableID,name:consumableName,code:consumableCode,descr:description,dCode:descrCode,amt:0,usable:eval(canUse)},conRef.all.push(consumableID)}}),Macro.add("addconsumable",{handler(){const e=setup.consumables.ref();if(this.args.length>2)return this.error("incorrect number of arguments");const t=this.args[0],s=1===this.args.length?1:this.args[1];if("number"!=typeof s)return this.error("optional second argument should be a number");if(!e.all.includes(t))return this.error("no consumable with id "+t+" is defined");e.carried.includes(t)||e.carried.push(t);const n=e[t];n.amt<=0&&(n.amt=0),n.amt+=s}}),Macro.add("dropconsumable",{handler(){const e=setup.consumables.ref();let t;if(this.args.length>2||this.args.length<1)return this.error("incorrect number of arguments");const s=this.args[0],n=1===this.args.length?1:this.args[1];if("number"!=typeof n)return this.error("optional second argument should be a number");if(!e.all.includes(s))return this.error("no cosumable with id "+s+" is defined");const i=e[s];i.amt-=n,i.amt<=0&&(i.amt=0,e.carried.includes(s)&&(t=e.carried.indexOf(s),e.carried.deleteAt(t)))}}),Macro.add("clearconsumables",{handler(){const e=setup.consumables.ref(),t=this.args,s=this.args.length;let n,i,r;if(s<1)return this.error("you must provide the ID of at least one consumable");if(!e.all.includesAll(t))return this.error("some or all of the provided consumable IDs do not exist");for(r=0;r<s;r++)(n=e[t[r]]).amt=0,e.carried.includes(t[r])&&(i=e.carried.indexOf(t[r]),e.carried.deleteAt(i))}}),Macro.add("deleteconsumables",{handler(){const e=setup.consumables.ref();let t,s=this.args,n=s.length,i=!1;if(n<1)return this.error("no consumable ids provided");if(1===n&&"all"===s[0].trim().toLowerCase())i=!0;else if(!e.all.includesAll(s))return this.error("some or all of the provided ids are not defined as consumables");for(i&&(n=(s=e.all).length),t=0;t<n;t++)setup.consumables.deleteConsumable(s[t])}}),Macro.add("useconsumable",{handler(){const e=$(document.createElement("span")),t=setup.consumables.ref();let s,n,i,r,a,o;if(s=!!setup.consumables.options.silentCode,this.args.length>2||this.args.length<1)return this.error("incorrect number of arguments");if(r=this.args[0],2===this.args.length&&("silent"===(n=this.args[1].trim().toLowerCase())||"noop"===n?s=!0:"unsilent"!==n&&"op"!==n||(s=!1)),!t.all.includes(r))return this.error("no consumable with ID "+r+" exists");t[r].usable()?(a=t[r].code,0===(o=t[r]).amt?(a="",t.carried.includes(r)&&(i=t.carried.indexOf(r),t.carried.deleteAt(i))):1===o.amt?(o.amt=0,i=t.carried.indexOf(r),t.carried.deleteAt(i)):o.amt--,s?new Wikifier(null,a):e.wiki(a).addClass("macro-"+this.name).appendTo(this.output)):setup.alert(`tried to use unusable consumable ${r}!`)}}),Macro.add("sortconsumables",{handler(){setup.consumables.ref().carried.sort()}}),Macro.add("listconsumables",{handler(){const e=$(document.createElement("span")),t=setup.consumables.ref();let s,n="";if(this.args.length>1)return this.error("incorrect number of arguments");s=1===this.args.length?this.args[0]:"\n",t.carried.length>0?t.carried.forEach(function(e,i,r){const a=t[e];n=n+a.name+": "+a.amt,n=i===r.length-1?n:n+s}):n=setup.consumables.options.emptyMsg,e.wiki(n).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("usableconsumables",{handler(){const e=$(document.createElement("span")),t=setup.consumables.ref();t.carried.length>0?t.carried.forEach(function(s,n,i){const r=$(document.createElement("span"));let a=$(document.createElement("a")),o=$(document.createElement("a"));const l=t[s],u=t[s].id.replace(/[^A-Za-z0-9]/g,"");l.descr&&null!=l.descr?(a.wiki(l.name).addClass("descr-link macro-usableconsumables").attr("id",u+"-descr"),"passage"===l.descr?a.ariaClick(function(){Dialog.setup(l.name,"consumable "+l.name+" "+l.id),Dialog.wiki(Story.get(l.dCode).processText()),Dialog.open()}):a.ariaClick(function(){setup.dialog("Item Information",l.dCode)})):a=l.name,l.usable()?o.wiki("Use").addClass("use-link macro-usableconsumables").attr("id",u+"-use").ariaClick(function(){new Wikifier(null,'<<useconsumable "'+l.id+'" "silent">>'),l.amt>0?$("#"+u+"-amt").empty().wiki(l.amt):$("#"+u).empty()}):o="<span style='color:#888;'>Use</span>",r.attr("id",u).append(a).wiki(': <span id="'+u+'-amt">'+l.amt+"</span> ").append(o),n<i.length-1&&r.wiki("<br />"),e.append(r)}):e.wiki(setup.consumables.options.emptyMsg),e.addClass("consumable-wrapper").appendTo(this.output)}}),Macro.add("usableconsumablesonly",{handler(){const e=$(document.createElement("span")),t=setup.consumables.ref();t.carried.length>0?t.carried.forEach(function(s,n,i){const r=$(document.createElement("span"));let a=$(document.createElement("a"));const o=$(document.createElement("a")),l=t[s],u=t[s].id.replace(/[^A-Za-z0-9]/g,"");l.descr&&null!=l.descr?(a.wiki(l.name).addClass("descr-link macro-usableconsumables").attr("id",u+"-descr"),"passage"===l.descr?a.ariaClick(function(){Dialog.setup(l.name,"consumable "+l.name+" "+l.id),Dialog.wiki(Story.get(l.dCode).processText()),Dialog.open()}):a.ariaClick(function(){setup.dialog("Item Information",l.dCode)})):a=l.name,l.usable()&&(o.wiki("Use").addClass("use-link macro-usableconsumables").attr("id",u+"-use").ariaClick(function(){new Wikifier(null,'<<useconsumable "'+l.id+'" "silent">>'),l.amt>0?$("#"+u+"-amt").empty().wiki(l.amt):$("#"+u).empty()}),r.attr("id",u).append(a).wiki(': <span id="'+u+'-amt">'+l.amt+"</span> ").append(o),n<i.length-1&&r.wiki("<br />"),e.append(r))}):e.wiki(setup.consumables.options.emptyMsg),e.addClass("consumable-wrapper").appendTo(this.output)}}),setup.consumables.options.macroAlts&&(Macro.add("consumable","newconsumable"),Macro.add("consumablemenu","usableconsumables")),Macro.add("douchebag",{handler(){if(this.args.length<3){const e=[];return this.args.length<1&&e.push("variable name "),this.args.length<2&&e.push("unchecked value "),this.args.length<3&&e.push("checked value "),this.error("no  "+e.join(" or  ")+" specified ")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");const e=this.args[0].trim();if("ↂ"!==e[0]&&"$"!==e[0]&&"_"!==e[0]&&"setup"!==e.slice(0,5))return this.error('variable name  "'+this.args[0]+' " is missing its sigil ($ or _)');const t="ↂ"===e[0],s=Util.slugify(e);let n=this.args[1],i=this.args[2];"string"==typeof this.args[1]&&"ↂ"===this.args[1][0]&&(n=setup.awsc.parse(this.args[1])),"string"==typeof this.args[2]&&"ↂ"===this.args[2][0]&&(i=setup.awsc.parse(this.args[2]));const r=document.createElement("input"),a=document.createElement("label");jQuery(r).attr({id:this.name+"-"+s,name:this.name+"-"+s,type:"checkbox",tabindex:0}).addClass("macro-"+this.name).on("change",function(){t?setup.awsc.set(e,this.checked?i:n):Wikifier.setValue(e,this.checked?i:n)}).appendTo(this.output),this.args.length>3&&"checked"===this.args[3]?(r.checked=!0,t?setup.awsc.set(e,i):Wikifier.setValue(e,i)):t?setup.awsc.set(e,n):Wikifier.setValue(e,n),jQuery(a).attr({for:this.name+"-"+s,name:this.name+"-"+s}).appendTo(this.output)}}),Macro.add("radiogaga",{handler(){if(this.args.length<7){const e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("checked value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");const e=this.args[0].trim();if("ↂ"!==e[0]&&"$"!==e[0]&&"_"!==e[0]&&"setup"!==e.slice(0,5))return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t="ↂ"===e[0],s=Util.slugify(e);let n=this.args[1];"string"==typeof this.args[1]&&setup.testes.test(this.args[1])&&(n=setup.awsc.parse(this.args[1])),t?setup.awsc.set(e,n):Wikifier.setValue(e,n);let i="bitch";switch(n){case-2:i="toggle_option_slider toggle_option_slider_one";break;case-1:i="toggle_option_slider toggle_option_slider_two";break;case 0:i="toggle_option_slider toggle_option_slider_three";break;case 1:i="toggle_option_slider toggle_option_slider_four";break;case 2:i="toggle_option_slider toggle_option_slider_five"}const r=document.createElement("div"),a=document.createElement("div"),o=document.createElement("input"),l=document.createElement("input"),u=document.createElement("input"),c=document.createElement("input"),d=document.createElement("input"),h=document.createElement("label");h.innerHTML=this.args[2];const m=document.createElement("label");m.innerHTML=this.args[3];const p=document.createElement("label");p.innerHTML=this.args[4];const g=document.createElement("label");g.innerHTML=this.args[5];const f=document.createElement("label");f.innerHTML=this.args[6],TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(s)||(TempState[this.name][s]=0);const v=this.name+"-"+s,b=this.name+"-"+s+"-"+TempState[this.name][s]++,y=this.name+"-"+s+"-"+TempState[this.name][s]++,w=this.name+"-"+s+"-"+TempState[this.name][s]++,C=this.name+"-"+s+"-"+TempState[this.name][s]++,k=this.name+"-"+s+"-"+TempState[this.name][s]++;jQuery(a).attr({id:v,class:i}).appendTo(r),jQuery(o).attr({id:b,name:this.name+"-"+s,type:"radio",class:"toggle_option",tabindex:0}).addClass("macro-"+this.name).on("change",function(){this.checked&&(t?setup.awsc.set(e,-2):Wikifier.setValue(e,-2),document.getElementById(v).className="toggle_option_slider toggle_option_slider_one")}).appendTo(r),jQuery(l).attr({id:y,name:this.name+"-"+s,type:"radio",class:"toggle_option",tabindex:0}).addClass("macro-"+this.name).on("change",function(){this.checked&&(t?setup.awsc.set(e,-1):Wikifier.setValue(e,-1),document.getElementById(v).className="toggle_option_slider toggle_option_slider_two")}).appendTo(r),jQuery(u).attr({id:w,name:this.name+"-"+s,type:"radio",class:"toggle_option",tabindex:0}).addClass("macro-"+this.name).on("change",function(){this.checked&&(t?setup.awsc.set(e,0):Wikifier.setValue(e,0),document.getElementById(v).className="toggle_option_slider toggle_option_slider_three")}).appendTo(r),jQuery(c).attr({id:C,name:this.name+"-"+s,type:"radio",class:"toggle_option",tabindex:0}).addClass("macro-"+this.name).on("change",function(){this.checked&&(t?setup.awsc.set(e,1):Wikifier.setValue(e,1),document.getElementById(v).className="toggle_option_slider toggle_option_slider_four")}).appendTo(r),jQuery(d).attr({id:k,name:this.name+"-"+s,type:"radio",class:"toggle_option",tabindex:0}).addClass("macro-"+this.name).on("change",function(){this.checked&&(t?setup.awsc.set(e,2):Wikifier.setValue(e,2),document.getElementById(v).className="toggle_option_slider toggle_option_slider_five")}).appendTo(r),jQuery(h).attr({for:b}).appendTo(r),jQuery(m).attr({for:y}).appendTo(r),jQuery(p).attr({for:w}).appendTo(r),jQuery(g).attr({for:C}).appendTo(r),jQuery(f).attr({for:k}).appendTo(r),jQuery(r).attr({class:"toggle_radio"}).appendTo(this.output)}}),Macro.add("dropdown",{handler(){if(this.args.length<2){const e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("list values"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");const e=this.args[0].trim();if("ↂ"!==e[0]&&"$"!==e[0]&&"_"!==e[0]&&"setup"!==e.slice(0,5))return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');let t=!1;"ↂ"===e[0]&&(t=!0),Config.debug&&this.debugView.modes({block:!0});const s=this.args.length;for(let e=1;e<s;e++)setup.testes.test(this.args[e])&&(this.args[e]=setup.awsc.parse(this.args[e]));const n=Util.slugify(e),i=this.args.slice(1).flatten(),r=Wikifier.getValue(e);let a=0;const o=document.createElement("select");for(let e=0;e<i.length;++e){const t=i[e];String(t)===r&&(a=e),jQuery(document.createElement("option")).text(t).appendTo(o)}jQuery(o).val(i[a]).attr({id:this.name+"-"+n,name:this.name+"-"+n,tabindex:0}).addClass("macro-"+this.name).on("change",function(){t?setup.awsc.set(e,this.value):Wikifier.setValue(e,this.value)}).appendTo(this.output),Wikifier.setValue(e,i[a])}}),setup.sInv={},setup.sInv.options={tryGlobal:!0,defaultStrings:{empty:"The inventory is empty...",listDrop:"Discard",separator:"\n"}},setup.sInv.attachEvent=function(e,t,s,n){$(document).trigger({type:"initialized"===n?":inventory-init":":inventory-update",instance:e,receiving:t,moved:s,context:n})},setup.sInv.inv=function(e){"use strict";if(e=e?(e=[].slice.call(arguments)).flatten():[],!(this instanceof setup.sInv.inv))return new setup.sInv.inv(e);this.inv=e,e=e.length?e:null,setup.sInv.attachEvent(this,null,e,"initialized")},setup.sInv.inv.is=function(e){return e instanceof setup.sInv.inv},setup.sInv.inv.log=function(e){return setup.sInv.inv.is(e)?"Inventory.log() -> "+e.toArray().join(" - "):"Inventory.log() -> object is not an inventory..."},setup.sInv.inv.removeDuplicates=function(e){if(!setup.sInv.inv.is(e))return;const t=e.toArray();return function(e){const s=[];return t.forEach(function(e){s.includes(e)||s.push(e)}),s}()},setup.sInv.inv.getUID=function(e,t){const s=Math.random().toString(36).substring(7);return arguments.length<2&&(e=Math.random().toString(36).substring(7),t=random(99)),"simple-inv-"+t+"-"+Date.now()+"-"+e.replace(/[^A-Za-z0-9]/g,"")+"-"+s},setup.sInv.inv.prototype={transfer(e){if(arguments.length<2)return this;if(!(e instanceof setup.sInv.inv))return this;let t=[].slice.call(arguments);const s=[];for(let e=0,n=(t=t.slice(1).flatten()).length;e<n;e++)this.inv.includes(t[e])&&(this.inv.delete(t[e]),s.push(t[e]));return s.length?(e.inv=e.inv.concat(s),setup.sInv.attachEvent(this,e,s,"transfer"),this):this},has(){const e=[].slice.call(arguments).flatten();return!(!e||!e.length)&&this.inv.includesAny(e)},hasAll(){const e=[].slice.call(arguments).flatten();return!(!e||!e.length)&&this.inv.includesAll(e)},pickUp(e){let t=[].slice.call(arguments).flatten();const s=this;return t&&t.length&&("unique"!==e&&"unique"!==t[0]||(t=function(e){const t=[];return e.forEach(function(e){s.inv.includes(e)||t.push(e)}),t}(t=t.splice(1))),this.inv=this.inv.concat(t),setup.sInv.attachEvent(this,null,t,"pickup")),this},drop(){const e=[].slice.call(arguments).flatten(),t=this;let s;if(e&&e.length){const n=[];e.forEach(function(e){t.has(e)&&(n.push(e),s=t.inv.indexOf(e),t.inv.deleteAt(s))}),setup.sInv.attachEvent(this,null,n,"drop")}return this},sort(){return this.inv=this.inv.sort(),setup.sInv.attachEvent(this,null,null,"sort"),this},show(e){return e&&"string"==typeof e||(e=setup.sInv.options.defaultStrings.separator),this.inv.length?this.inv.join(e):setup.sInv.options.defaultStrings.empty},showDisp(){const e=this.inv.length;let t="";for(let s=0;s<e;s++){if(null!==aw.invItems.info[this.inv[s]]&&void 0!==aw.invItems.info[this.inv[s]]){let e="[img[IMG-InventoryNoImage]]";null!==aw.invItems.image[this.inv[s]]&&void 0!==aw.invItems.image[this.inv[s]]&&(e="[img["+aw.invItems.image[this.inv[s]]+"]]"),t+=`<<link "${this.inv[s]}">><<dialog "${this.inv[s]}">><div class="consumable">${e}<h3>${this.inv[s]}</h3>${aw.invItems.info[this.inv[s]]}</div><</dialog>><</link>>`}else t+=this.inv[s];t+="<br>"}return t},empty(){const e=clone(this.inv);return this.inv=[],setup.sInv.attachEvent(this,null,e,"drop"),this},toArray(){return this.inv},linkedList(e,t){e&&e instanceof setup.sInv.inv||(e=!1);const s=this.toArray(),n=this,i=$(document.createElement("span"));return s&&s.length?(s.forEach(function(s,r,a){const o=$(document.createElement("span")),l=$(document.createElement("a")),u=t||setup.sInv.options.defaultStrings.drop,c=setup.sInv.inv.getUID(s,r);l.wiki(u).addClass("simple-inv drop-link"),l.ariaClick(function(){e?n.transfer(e,s):n.drop(s),$("#"+c).empty()}),o.attr("id",c).addClass("simple-inv link-listing").wiki(s+" ").append(l),r<a.length-1&&o.wiki("<br />"),i.append(o)}),i):(i.wiki(setup.sInv.options.defaultStrings.empty),i)},constructor:setup.sInv.inv,toJSON(){return JSON.reviveWrapper("new setup.sInv.inv("+JSON.stringify(this.inv)+")")},clone(){return new setup.sInv.inv(this.inv)}},setup.sInv.options.tryGlobal&&(window.Inventory=window.Inventory||setup.sInv.inv),Macro.add("newinventory",{handler(){if(1!==this.args.length)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Wikifier.setValue(e,new setup.sInv.inv(this.args.slice(1).flatten()))}}),Macro.add("pickup",{handler(){if(this.args.length<2)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t=Wikifier.getValue(e);if(!setup.sInv.inv.is(t))return this.error("variable "+e+" is not an inventory!");t.pickUp(this.args.slice(1).flatten())}}),Macro.add("drop",{handler(){if(this.args.length<2)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t=Wikifier.getValue(e);if(!setup.sInv.inv.is(t))return this.error("variable "+e+" is not an inventory!");t.drop(this.args.slice(1).flatten())}}),Macro.add("transfer",{handler(){if(this.args.length<3)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t=Wikifier.getValue(e);if(!setup.sInv.inv.is(t))return this.error("variable "+e+" is not an inventory!");const s=this.args[1].trim();if("$"!==s[0]&&"_"!==s[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');const n=Wikifier.getValue(s);if(!setup.sInv.inv.is(n))return this.error("variable "+s+" is not an inventory!");t.transfer(n,this.args.slice(2).flatten())}}),Macro.add("dropall",{handler(){if(1!==this.args.length)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t=Wikifier.getValue(e);if(!setup.sInv.inv.is(t))return this.error("variable "+e+" is not an inventory!");t.empty()}}),Macro.add("clear","dropall",!1),Macro.add("sort",{handler(){if(1!==this.args.length)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t=Wikifier.getValue(e);if(!setup.sInv.inv.is(t))return this.error("variable "+e+" is not an inventory!");t.sort()}}),Macro.add("inventory",{handler(){if(this.args.length<1||this.args.length>2)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t=Wikifier.getValue(e);if(!setup.sInv.inv.is(t))return this.error("variable "+e+" is not an inventory!");const s=$(document.createElement("span")),n=!!this.args[1]&&this.args[1];s.wiki(t.show(n)).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("inventorydisplay",{handler(){if(this.args.length<1||this.args.length>1)return this.error("incorrect number of arguments");const e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');const t=Wikifier.getValue(e);if(!setup.sInv.inv.is(t))return this.error("variable "+e+" is not an inventory!");$(document.createElement("span")).wiki(t.showDisp()).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("linkedinventory",{handler(){if(this.args.length<2||this.args.length>3)return this.error("incorrect number of arguments");let e=!1;const t=this.args[1].trim(),s="string"==typeof this.args[0]&&this.args[0];if(!s)return this.error("first argument should be the link text");if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');let n=Util.slugify(t);n=this.name+"-"+n;const i=Wikifier.getValue(t);if(!setup.sInv.inv.is(i))return this.error("variable "+t+" is not an inventory!");if(this.args.length>2){const t=this.args[2].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[2]+'" is missing its sigil ($ or _)');if(e=Wikifier.getValue(t),!setup.sInv.inv.is(e))return this.error("variable "+t+" is not an inventory!")}i.linkedList(e,s).attr("id",n).addClass("macro-"+this.name).appendTo(this.output)}}),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):t(e.jQuery)}(window,function(e){var t,s,n,i,r,a,o,l,u,c,d;if(s=!!document.createElement("canvas").getContext,t=function(){var e=document.createElement("div");e.innerHTML='<v:shape id="vml_flag1" adj="1" />';var t=e.firstChild;return t.style.behavior="url(#default#VML)",!t||"object"==typeof t.adj}(),s||t){if(s){l=function(e){return Math.max(0,Math.min(parseInt(e,16),255))},u=function(e,t){return"rgba("+l(e.substr(0,2))+","+l(e.substr(2,2))+","+l(e.substr(4,2))+","+t+")"},n=function(t){var s=e('<canvas style="width:'+e(t).width()+"px;height:"+e(t).height()+'px;"></canvas>').get(0);return s.getContext("2d").clearRect(0,0,e(t).width(),e(t).height()),s};var h=function(e,t,s,n,i){if(n=n||0,i=i||0,e.beginPath(),"rect"==t)e.rect(s[0]+n,s[1]+i,s[2]-s[0],s[3]-s[1]);else if("poly"==t){e.moveTo(s[0]+n,s[1]+i);for(var r=2;r<s.length;r+=2)e.lineTo(s[r]+n,s[r+1]+i)}else"circ"==t&&e.arc(s[0]+n,s[1]+i,s[2],0,2*Math.PI,!1);e.closePath()};i=function(t,s,n,i,r){var a=t.getContext("2d");if(i.shadow){a.save(),"inside"==i.shadowPosition&&(h(a,s,n),a.clip());var o=100*t.width,l=100*t.height;h(a,s,n,o,l),a.shadowOffsetX=i.shadowX-o,a.shadowOffsetY=i.shadowY-l,a.shadowBlur=i.shadowRadius,a.shadowColor=u(i.shadowColor,i.shadowOpacity);var c=i.shadowFrom;c||(c="outside"==i.shadowPosition?"fill":"stroke"),"stroke"==c?(a.strokeStyle="rgba(0,0,0,1)",a.stroke()):"fill"==c&&(a.fillStyle="rgba(0,0,0,1)",a.fill()),a.restore(),"outside"==i.shadowPosition&&(a.save(),h(a,s,n),a.globalCompositeOperation="destination-out",a.fillStyle="rgba(0,0,0,1);",a.fill(),a.restore())}a.save(),h(a,s,n),i.fill&&(a.fillStyle=u(i.fillColor,i.fillOpacity),a.fill()),i.stroke&&(a.strokeStyle=u(i.strokeColor,i.strokeOpacity),a.lineWidth=i.strokeWidth,a.stroke()),a.restore(),i.fade&&e(t).css("opacity",0).animate({opacity:1},100)},r=function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}}else n=function(t){return e('<var style="zoom:1;overflow:hidden;display:block;width:'+t.width+"px;height:"+t.height+'px;"></var>').get(0)},i=function(t,s,n,i,r){var a,o,l,u;for(var c in n)n[c]=parseInt(n[c],10);a='<v:fill color="#'+i.fillColor+'" opacity="'+(i.fill?i.fillOpacity:0)+'" />',o=i.stroke?'strokeweight="'+i.strokeWidth+'" stroked="t" strokecolor="#'+i.strokeColor+'"':'stroked="f"',l='<v:stroke opacity="'+i.strokeOpacity+'"/>',"rect"==s?u=e('<v:rect name="'+r+'" filled="t" '+o+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+n[0]+"px;top:"+n[1]+"px;width:"+(n[2]-n[0])+"px;height:"+(n[3]-n[1])+'px;"></v:rect>'):"poly"==s?u=e('<v:shape name="'+r+'" filled="t" '+o+' coordorigin="0,0" coordsize="'+t.width+","+t.height+'" path="m '+n[0]+","+n[1]+" l "+n.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+t.width+"px;height:"+t.height+'px;"></v:shape>'):"circ"==s&&(u=e('<v:oval name="'+r+'" filled="t" '+o+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(n[0]-n[2])+"px;top:"+(n[1]-n[2])+"px;width:"+2*n[2]+"px;height:"+2*n[2]+'px;"></v:oval>')),u.get(0).innerHTML=a+l,e(t).append(u)},r=function(t){var s=e("<div>"+t.innerHTML+"</div>");s.children("[name=highlighted]").remove(),t.innerHTML=s.html()};a=function(e){var t,s=e.getAttribute("coords").split(",");for(t=0;t<s.length;t++)s[t]=parseFloat(s[t]);return[e.getAttribute("shape").toLowerCase().substr(0,4),s]},d=function(t,s){var n=e(t);return e.extend({},s,!!e.metadata&&n.metadata(),n.data("maphilight"))},c=function(e){return!!e.complete&&(void 0===e.naturalWidth||0!==e.naturalWidth)},o={position:"absolute",left:0,top:0,padding:0,border:0};var m=!1;e.fn.maphilight=function(l){return l=e.extend({},e.fn.maphilight.defaults,l),s||m||(e(window).ready(function(){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var t=document.createStyleSheet();e.each(["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"],function(){t.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")})}),m=!0),this.each(function(){var u,h,m,p,g,f,v;if(u=e(this),!c(this))return window.setTimeout(function(){u.maphilight(l)},200);if(m=e.extend({},l,!!e.metadata&&u.metadata(),u.data("maphilight")),(v=u.get(0).getAttribute("usemap"))&&(p=e('map[name="'+v.substr(1)+'"]'),u.is('img,input[type="image"]')&&v&&p.length>0)){if(u.hasClass("maphilighted")){var b=u.parent();u.insertBefore(b),b.remove(),e(p).unbind(".maphilight")}h=e("<div></div>").css({display:"block",backgroundImage:'url("'+this.src+'")',backgroundSize:"contain",position:"relative",padding:0,width:this.width,height:this.height}),m.wrapClass&&(!0===m.wrapClass?h.addClass(e(this).attr("class")):h.addClass(m.wrapClass)),u.before(h).css("opacity",0).css(o).remove(),t&&u.css("filter","Alpha(opacity=0)"),h.append(u),g=n(this),e(g).css(o),g.height=this.height,g.width=this.width,e(p).bind("alwaysOn.maphilight",function(){f&&r(f),s||e(g).empty(),e(p).find("area[coords]").each(function(){var t,r;(r=d(this,m)).alwaysOn&&(!f&&s&&(f=n(u[0]),e(f).css(o),f.width=u[0].width,f.height=u[0].height,u.before(f)),r.fade=r.alwaysOnFade,t=a(this),i(s?f:g,t[0],t[1],r,""))})}).trigger("alwaysOn.maphilight").bind("mouseover.maphilight, focus.maphilight",function(t){var n,r,o=t.target;if(!(r=d(o,m)).neverOn&&!r.alwaysOn){if(n=a(o),i(g,n[0],n[1],r,"highlighted"),r.groupBy){var l;l=/^[a-zA-Z][\-a-zA-Z]+$/.test(r.groupBy)?p.find("area["+r.groupBy+'="'+e(o).attr(r.groupBy)+'"]'):p.find(r.groupBy);var u=o;l.each(function(){if(this!=u){var e=d(this,m);if(!e.neverOn&&!e.alwaysOn){var t=a(this);i(g,t[0],t[1],e,"highlighted")}}})}s||e(g).append("<v:rect></v:rect>")}}).bind("mouseout.maphilight, blur.maphilight",function(e){r(g)}),u.before(g),u.addClass("maphilighted")}})},e.fn.maphilight.defaults={fill:!0,fillColor:"000000",fillOpacity:.2,stroke:!0,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:!0,alwaysOn:!1,neverOn:!1,groupBy:!1,wrapClass:!0,shadow:!1,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:!1}}else e.fn.maphilight=function(){return this}}),$(document.body).append("<div id='notify'></div>"),$(document).on(":notify",function(e){e.message&&"string"==typeof e.message&&(e.message.trim(),e.class?"string"==typeof e.class?e.class="open macro-notify "+e.class:Array.isArray(e.class)?e.class="open macro-notify "+e.class.join(" "):e.class="open macro-notify":e.class="open macro-notify",e.delay?("number"!=typeof e.delay&&(e.delay=Number(e.delay)),Number.isNaN(e.delay)&&(e.delay=4e3)):e.delay=4e3,$("#notify").empty().wiki(e.message).addClass(e.class),setTimeout(function(){$("#notify").removeClass()},e.delay))}),Macro.add("notify",{tags:null,handler(){const e=this.payload[0].contents;let t=!1,s=!1;this.args.length>0&&("number"==typeof this.args[0]?(t=this.args[0],s=this.args.length>1&&this.args.slice(1).flatten()):s=this.args.flatten().join(" ")),$(document).trigger({type:":notify",message:e,delay:t,class:s})}}),setup.notify=function(e,t=!1,s=!1){"number"!=typeof t&&(s=t,t=!1),"string"!=typeof s&&(s=!!Array.isArray(s)&&s.flatten().join(" ")),$(document).trigger({type:":notify",message:e,delay:t,class:s})},function(){version.extensions.replaceMacrosCombined={major:1,minor:1,revision:7};var e={handler:function(){}};function t(e,t){e&&(e.innerHTML="",new Wikifier(e,e.tweecode),e.setAttribute("data-enabled","true"),e.style.display="inline",e.classList.remove("revision-span-out"),t||(e.classList.add("revision-span-in"),e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){e.classList.remove("revision-span-in"),e=null},20)))}function s(e,t){e&&(e.setAttribute("data-enabled","false"),e.classList.remove("revision-span-in"),e.timeout&&clearTimeout(e.timeout),t?(e.style.display="none",e.innerHTML="",e=null):(e.classList.add("revision-span-out"),e.timeout=setTimeout(function(){"false"==e.getAttribute("data-enabled")&&(e.classList.remove("revision-span-out"),e.style.display="none",e.innerHTML=""),e=null},1e3)))}function n(e,t,s,n,i){var r,a,o,l=0,u="";function c(e,t,s){for(var n=0;n<t.length;n++)if(a.indexOf("<<"+t[n]+(s?">>":""),e)==e)return t[n]}for(a=e.source.slice(i),o=0;o<a.length;o++){if(r=c(o,t))l++;else{if((r=c(o,s,!0))&&0==l)return e.nextMatch=i+o+r.length+4,[u,r];if((r=c(o,n,!0))&&--l<0)return null}u+=a.charAt(o)}return null}var i=[],r=[];function a(e,s,a,o){var l,u,c,d,h,m=o.source.indexOf(">>",o.matchStart)+2,p=[],g=s,f=a.length;function v(e){return(d=insertElement(c,"span",null,"revision-span "+e)).setAttribute("data-enabled",!1),d.style.display="none",d.tweecode="",d}if(this.shorthand&&f)for(;a.length>0;)p.push([a.shift(),"insert"==this.flavour?"gains":"becomes"]);else("insert"==this.flavour||"continue"==this.flavour&&"time"==this.trigger)&&p.push(["","becomes"]);if("continue"==this.flavour&&f)o.nextMatch=m+o.source.slice(m).length,p.push([o.source.slice(m),g]);else{if((u=n(o,i,(l=["becomes","gains"]).concat(r),r,m))&&-1==r.indexOf(u[1])){for(;u;)p.push(u),u=n(o,i,l,r,o.nextMatch);u=n(o,i,["end"+s],r,o.nextMatch)}if(!u)return void throwError(e,"can't find matching end"+s);p.push(u),"continue"==this.flavour&&(m=o.nextMatch,o.nextMatch=m+o.source.slice(m).length,p.push([o.source.slice(m),""]))}for("remove"==this.flavour&&p.push(["","becomes"]),0,(c=insertElement(e,"span",null,s)).setAttribute("data-flavour",this.flavour),d=v("initial"),h=p.shift(),d.tweecode=h[0],t(d,!0);p.length>0;)h&&(g=h[1]),h=p.shift(),(d=v(g)).tweecode=h[0];"function"==typeof this.setup&&this.setup(c,e,a)}function o(e,t,s){e.className+=" "+s[0].replace(" ","_")}function l(e,t,s){s[0];e.setEventListener("keydown",function t(s){!f("revise",e)&&e.removeEventListener("keydown",t)})}function u(e,t,s){var n=function(e){if("string"==typeof e){if("ms"==e.slice(-2).toLowerCase())return Number(e.slice(0,-2))||0;if("s"==e.slice(-1).toLowerCase())return 1e3*Number(e.slice(0,-1))||0}return throwError(t,e+" isn't a CSS time unit"),0}(s[0]),i=state.history[0].passage.title;setTimeout(function t(){state.history[0].passage.title==i&&(!f("revise",e)||setTimeout(t,n))},n)}function c(e){var t,s=null!==document.head.onmouseenter,n=e.children[0],i=e.children[1],r=i.className.indexOf("gains")>-1;n&&i&&(n.onmouseenter=function(e){for(var t=document.elementFromPoint(e.clientX,e.clientY);t&&t!==this;)t=t.parentNode;t&&"false"!=this.getAttribute("data-enabled")&&f("revise",this.parentNode)},i.onmouseleave=function(e){for(var t=document.elementFromPoint(e.clientX,e.clientY);t&&t!==this;)t=t.parentNode;t||"false"!=this.getAttribute("data-enabled")&&f("revert",this.parentNode)},r&&(n.onmouseleave=i.onmouseleave),s&&(t=function(e){return function(t){event.relatedTarget&&(event.relatedTarget==this||this.compareDocumentPosition(event.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY)||this[e]()}},n.onmouseover=t("onmouseenter"),i.onmouseout=t("onmouseleave"),r&&(n.onmouseout=i.onmouseout)),e=null)}function d(e){var t=null===document.head.onmouseenter?"onmouseenter":"onmouseover";e[t]=function(){!f("revise",this)&&(this[t]=null)},e=null}function h(e,t,s){var n=Wikifier.createInternalLink(),i=e.parentNode;n.className="internalLink replaceLink",i.insertBefore(n,e),n.insertBefore(e,null),n.onclick=function(){var t=!1;e&&e.parentNode==this&&(t=!f("revise",e),scrollWindowTo(e)),t&&(this.parentNode.insertBefore(e,this),this.parentNode.removeChild(this))},n=null}function m(e,t,s){var n,i,r=state.history[0].variables,a="once seen",o=e.firstChild&&("insert"==this.flavour?e.firstChild.nextSibling:e.firstChild).tweecode;if(r[a]=r[a]||{},o&&!r[a].hasOwnProperty(o))r[a][o]=1;else{for(n=r[a][o];n>0&&!i;n--)i=!f("revise",e,!0);r[a].hasOwnProperty(o)&&(r[a][o]+=1)}}function p(e){for(var t=e.parentNode;!t.classList.contains("passage");){if(t.classList.contains("revision-span-out"))return!0;t=t.parentNode}}function g(e,t){for(var s=document.querySelectorAll(".passage [data-flavour]."+t),n=!1,i=0;i<s.length;i++)p(s[i])||(n=f(e,s[i])||n);return n}function f(e,n,i){var r,a,o,l=-1,u="revert"==e,c=e.indexOf("random")>-1,d=n.getAttribute("data-flavour"),h=n.childNodes,m="cycle"==d,p=h.length-1;function g(e,t){for(var s=e-1;s>=0&&h[s+1].classList.contains("gains");s--)t(h[s],i)}for(var f=0;f<=p;f++)"true"==h[f].getAttribute("data-enabled")&&(l=f);u&&(l-=1),a=l>=0?h[l]:m?h[p]:null,r=l,c&&(r=(l+Math.floor(Math.random()*p))%p),o=r<p?h[r+1]:m?h[0]:null;var v=u?t:s,b=u?s:t,y=function(){o&&o.classList.contains("gains")&&!c||(v(a,i),g(l,v))},w=function(){b(o,i),c&&g(r+1,b)};return u?(w(),y()):(y(),w()),!!m||(u?l>0:r<p-1)}[{name:"insert",flavour:"insert",trigger:"link",setup:h},{name:"timedinsert",flavour:"insert",trigger:"time",setup:u},{name:"insertion",flavour:"insert",trigger:"revisemacro",setup:o},{name:"later",flavour:"insert",trigger:"visited",setup:m},{name:"keyinsert",flavour:"insert",trigger:"key",setup:l},{name:"replace",flavour:"replace",trigger:"link",setup:h},{name:"timedreplace",flavour:"replace",trigger:"time",setup:u},{name:"mousereplace",flavour:"replace",trigger:"mouse",setup:d},{name:"hoverreplace",flavour:"replace",trigger:"hover",setup:c},{name:"revision",flavour:"replace",trigger:"revisemacro",setup:o},{name:"keyreplace",flavour:"replace",trigger:"key",setup:l},{name:"timedremove",flavour:"remove",trigger:"time",setup:u},{name:"mouseremove",flavour:"remove",trigger:"mouse",setup:d},{name:"hoverremove",flavour:"remove",trigger:"hover",setup:c},{name:"removal",flavour:"remove",trigger:"revisemacro",setup:o},{name:"once",flavour:"remove",trigger:"visited",setup:m},{name:"keyremove",flavour:"remove",trigger:"key",setup:l},{name:"continue",flavour:"continue",trigger:"link",setup:h},{name:"timedcontinue",flavour:"continue",trigger:"time",setup:u},{name:"mousecontinue",flavour:"continue",trigger:"mouse",setup:d},{name:"keycontinue",flavour:"continue",trigger:"key",setup:l},{name:"cycle",flavour:"cycle",trigger:"revisemacro",setup:o},{name:"mousecycle",flavour:"cycle",trigger:"mouse",setup:d},{name:"timedcycle",flavour:"cycle",trigger:"time",setup:u},{name:"keycycle",flavour:"replace",trigger:"key",setup:l}].forEach(function(t){t.handler=a,t.shorthand=["link","mouse","hover"].indexOf(t.trigger)>-1,macros[t.name]=t,macros["end"+t.name]=e,i.push(t.name),r.push("end"+t.name)}),macros.revert=macros.revise=macros.randomise=macros.randomize={handler:function(e,t,s){var n,i;function r(e){e.style.display="none"}function a(e){e.style.display="inline"}function o(e){if(e.className.indexOf("random")>-1)a(e);else{var t,s,n,o,l,u=document.querySelectorAll(".passage [data-flavour]."+i);for(n=0;n<u.length;n++)l=(o=u[n]).getAttribute("data-flavour"),p(o)||("cycle"==l?t=s=!0:(o.firstChild.getAttribute("data-enabled")==!1+""&&(s=!0),o.lastChild.getAttribute("data-enabled")==!1+""&&(t=!0)));((e.classList.contains("revert")?s:t)?a:r)(e)}}function l(e){e.classList.toggle(u+"Enabled"),e.classList.toggle(u+"Disabled"),e.style.display="none"==e.style.display?"inline":"none"}var u="reviseLink";if(s.length<2)throwError(e,t+" macro needs 2 parameters");else{i=s.shift().replace(" ","_"),(n=Wikifier.createInternalLink(e,null)).className="internalLink "+u+" "+u+"_"+i+" "+t;var c="",d=!1,h=!1;switch(s.length>1&&"$"==s[0][0]&&(c=s[0].slice(1),s.shift()),s[s.length-1]){case"end":d=!0,s.pop();break;case"out":h=!0,s.pop()}for(var m=state.history[0].variables,f=0;f<s.length;f++){var v=f==Math.max(s.indexOf(m[c]),0),b=insertElement(null,"span",null,u+(v?"En":"Dis")+"abled");v?(m[c]=s[f],n.setAttribute("data-cycle",f)):b.style.display="none",insertText(b,s[f]),n.appendChild(b)}n.onclick=function(){g(t,i);var e,n,r,a=this.childNodes,p=this.getAttribute("data-cycle")-0,f=a.length;if((d||h)&&p>=f-(d?2:1)){if(!d)return void this.parentNode.removeChild(this);(e=this.removeChild(a[p+1]||a[p])).className=u+"End",e.style.display="inline",this.parentNode.replaceChild(e,this)}else l(a[p]),p=(p+1)%f,c&&(m[c]=s[p]),l(a[p]),this.setAttribute("data-cycle",p);for(n=document.getElementsByClassName(u+"_"+i),r=0;r<n.length;r++)o(n[r])},r(n),setTimeout(function(e){return function(){o(e)}}(n),1),n=null}}},macros.mouserevise=macros.hoverrevise={handler:function(e,t,s,i){var r=["end"+t],a=null===window.onmouseenter?"onmouseenter":"onmouseover",o=n(i,[t],r,r,i.source.indexOf(">>",i.matchStart)+2);if(o){var l=s[0].replace(" ","_"),u=insertElement(e,"span",null,"hoverrevise hoverrevise_"+l),c=function(){var e=!g("revise",l);"hoverrevise"!=t&&e&&(this[a]=null)};new Wikifier(u,o[0]),"hoverrevise"==t?(u.onmouseover=c,u.onmouseout=function(){g("revert",l)}):u[a]=c,u=null}}},macros.instantrevise={handler:function(e,t,s,n){g("revise",s[0].replace(" ","_"))}},macros.endmouserevise=e,macros.endhoverrevise=e}(),Macro.add("terminal",{tags:["input","output"],handler(){const e=this.payload.length,t=[];for(let s=1;s<e;s++)if("input"===this.payload[s].name){const n=this.payload[s].contents.split("<br>");for(let e=0,t=n.length;e<t;e++)n[e]+="^400";const i={action:"type",strings:n,postDelay:this.payload[s].args.length>0&&"number"==typeof this.payload[s].args[0]?this.payload[s].args[0]:1e3};s+1<e&&"output"===this.payload[s+1].name&&(i.output='<div class="output">'+this.payload[s+1].contents.trim()+"</div>",s++),t.push(i)}else if("output"===this.payload[s].name){const e={action:"type",postDelay:this.payload[s].args.length>0&&"number"==typeof this.payload[s].args[0]?this.payload[s].args[0]:1e3,output:this.payload[s].contents,strings:["^400"]};t.push(e)}setTimeout(()=>(function e(t,s){const n=$(".prompt"),i=t[s];switch(!0===i.clear&&$(".history").html(""),i.action){case"type":n.removeData(),$(".typed-cursor").text(""),n.typed({strings:i.strings,typeSpeed:30,callback(){let r=$(".history").html();(r=r?[r]:[]).push("$ "+n.text()),i.output&&(r.push(i.output),n.html(""),$(".history").html(r.join("<br>"))),$("section.terminal").scrollTop(5e3),++s<t.length&&setTimeout(function(){e(t,s)},i.postDelay||1e3)}})}})(t,0),70);let s="GLADyS OS Terminal v0.77.3";this.payload[0].args.length>0&&(s=this.payload[0].args[0].trim());const n='<div class="terminalCunt"><div class="Terminalheader">'+"<img data-passage='IMG-terminalIcons'><div style='display:inline-block;vertical-align:top;'>"+s+'</div></div><div class="terminal-window"><section class="terminal"><div class="history"></div>$&nbsp;<span class="prompt"></span><span class="typed-cursor"></span></section></div></div>';return new Wikifier(this.output,n)}});